<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="boardMapper">
  	
  	<select id="listCount" resultType="_int">
  		SELECT COUNT(*)
  		FROM BOARD
  		WHERE STATUS = 'Y'
  	</select>
  	
  	<!-- 
  	  <select id="listCount" resultType="_int">
  	    SELECT COUNT(*)
  	    FROM BOARD
  	    WHERE STATUS = 'Y'
  	  </select>   
  	-->
  
  	<select id="boardList" resultType="Board">
  		SELECT BOARD_NO
  			  ,BOARD_TITLE
  			  ,BOARD_WRITER
  			  ,COUNT
  			  ,CREATE_DATE
  			  ,ORIGIN_NAME
  			  ,CHANGE_NAME
  		FROM BOARD
  		WHERE STATUS = 'Y'
  		ORDER BY CREATE_DATE DESC
  	</select>
  	
  	<!-- 
  	<select id="boardList" resultType="Board">
  	    SELECT BOARD_NO
  	           ,BOARD_TITLE
  	           ,BOARD_WRITER
  	           ,COUNT
  	           ,CREATE_DATE
  	           ,ORIGIN_NAME
  	           ,CHANGE_NAME
  	    FROM BOARD
  	    WHERE STATUS = 'Y'
  	    ORDER BY CREATE_DATE DESC        
  	</select>
  	 -->
  	
  	
  	<update id="increaseCount" parameterType="_int">
  		UPDATE BOARD
  		SET COUNT = COUNT+1
  		WHERE BOARD_NO = #{bno}
  		AND STATUS = 'Y'
  	</update>
  	
  	<!-- 
  	<update id="increaseCount" parameterType="_int">
  	    UPDATE BOARD
  	    SET COUNT = COUNT+1
  	    WHERE BOARD_NO = #{bno}
  	    AND STATUS = 'Y'
  	 -->
  	
  	<select id="boardDetail" resultType="Board" parameterType="_int">
  		SELECT BOARD_NO
  			  ,BOARD_TITLE
  			  ,BOARD_WRITER
  			  ,BOARD_CONTENT
  			  ,ORIGIN_NAME
  			  ,CHANGE_NAME
  			  ,CREATE_DATE
  		FROM BOARD
  		WHERE BOARD_NO = #{bno}
  		AND STATUS ='Y'
  	</select>
  	
  	<!-- 
  	<select id="boardDetail" resultType="Board" parameterType="_int">
  	    SELECT BOARD_NO
  	           ,BOARD_TITLE
  	           ,BOARD_WRITER
  	           ,BOARD_CONTENT
  	           ,ORIGIN_NAME
  	           ,CHANGE_NAME
  	           ,CREATE_DATE
  	    FROM BOARD
  	    WHERE BOARD_NO = #{bno}
  	    AND STATUS = 'Y'        
  	</select>
  	 -->
  	
  	<insert id="boardInsert" parameterType="Board">
  		INSERT INTO BOARD(BOARD_NO
  						 ,BOARD_TITLE
  						 ,BOARD_WRITER
  						 ,BOARD_CONTENT
  						 ,CHANGE_NAME
  						 ,ORIGIN_NAME)
  		VALUES(SEQ_BNO.NEXTVAL
  			  ,#{boardTitle}
  			  ,#{boardWriter}
  			  ,#{boardContent}
  			  ,#{changeName}
  			  ,#{originName})
  	</insert>
  	
  	<!-- 
  	
  	<insert id="boardInsert" parameterType="Board">
  	    INSERT INTO BOARD(BOARD_NO
  	                      ,BOARD_TITLE
  	                      ,BOARD_WRITER
  	                      ,BOARD_CONTENT
  	                      ,CHANGE_NAME
  	                      ,ORIGIN_NAME)
  	    VALUES(SEQ_BNO.NEXTVAL
  	            ,#{boardTitle}
  	            ,#{boardWriter}
  	            ,#{boardContent}
  	            ,#{changeName}
  	            ,#{originName})
  	</insert>                               
  	
  	 -->
  	
  	<update id="updateBoard" parameterType="Board">
  		UPDATE BOARD 
  		SET BOARD_TITLE = #{boardTitle}
  		   ,BOARD_CONTENT = #{boardContent}
  		   ,CHANGE_NAME = #{changeName}
  		   ,ORIGIN_NAME = #{originName}
  		WHERE BOARD_NO = #{boardNo}
  		AND STATUS = 'Y'
  	</update>
  	
  	<!-- 
  	<update id="updateBoard" parameterType="Board">
  	    UPDATE BOARD
  	    SET BOARD_TITLE = #{boardTitle}
  	        ,BOARD_CONTENT = #{boardContent}
  	        ,CHANGE_NAME = #{changeName}
  	        ,ORIGIN_NAME = #{originName}
  	    WHERE BOARD_NO = #{boardNo}
  	    AND STATUS = 'Y'     
  	 -->
  	
  	<delete id="deleteBoard" parameterType="_int">
  		DELETE FROM BOARD
  		WHERE BOARD_NO = #{bno}
  	</delete>
  	
  	<delete id="boardDelete" parameterType="_int">
  	    DELETE FROM BOARD
  	    WHERE BOARD_NO = #{bno}
  	</delete>
   
   <!-- 
   <update id="deleteBoard" parameterType="_int">
   		UPDATE BOARD
   		SET STATUS = 'N'
   		WHERE BOARD_NO = #{bno}
   </update>
   -->
  	
  	<!-- 검색을 위한 동적 sql 처리  
  		 test안에서 조건처리 연산자는 java문법처럼 사용 (같다 == , = 할당 ) 주의 !
  	-->
  	<select id="searchList" resultType="Board" parameterType="hashmap">
  		SELECT BOARD_NO
  			  ,BOARD_TITLE
  			  ,BOARD_WRITER
  			  ,COUNT
  			  ,CREATE_DATE
  			  ,ORIGIN_NAME
  			  ,CHANGE_NAME
		FROM BOARD
		<choose>
			<when test="condition == 'title'">
				WHERE BOARD_TITLE LIKE '%'||#{keyword}||'%'
			</when>
			<when test="condition == 'writer'">
				WHERE BOARD_WRITER = #{keyword} 
			</when>
			<otherwise>
				WHERE BOARD_CONTENT LIKE '%'||#{keyword}||'%' 
			</otherwise>			
		</choose>
  		AND STATUS = 'Y'
  	</select>
  	
  	<!-- 검색된 게시글 개수  -->
  	<select id="searchListCount" resultType="_int">
  		SELECT COUNT(*)
		FROM BOARD
		<choose>
			<when test="condition == 'title'">
				WHERE BOARD_TITLE LIKE '%'||#{keyword}||'%'
			</when>
			<when test="condition == 'writer'">
				WHERE BOARD_WRITER = #{keyword} 
			</when>
			<otherwise>
				WHERE BOARD_CONTENT LIKE '%'||#{keyword}||'%' 
			</otherwise>			
		</choose>
  		AND STATUS = 'Y'
  	
  	</select>
  	
  	<!--  
  	<select id="replyList" resultType="Reply">
  	    SELECT REPLY_NO
  	           ,REPLY_CONTENT
  	           ,REF_BNO
  	           ,REPLY_WRITER
  	           ,CREATE_DATE
  	           ,STATUS
  	    FROM REPLY
  	    WHERE STATUS='Y'       
  	
  	</select>
  	-->
  	
  	<select id="replyList" resultType="Reply" parameterType="_int">
  	   SELECT REPLY_NO
  	          ,REPLY_CONTENT
  	          ,REPLY_WRITER
  	          ,TO_CHAR(CREATE_DATE,'YYYY-MM-DD') "CREATE_DATE"
  	   FROM REPLY
  	   WHERE REF_BNO = #{refBno}
  	   AND STATUS = 'Y'
  	   ORDER BY CREATE_DATE DESC        
  	
  	</select>
  	
  	<insert id="insertReply" parameterType="Reply">
  	   INSERT INTO REPLY(REPLY_NO
  	                     ,REPLY_CONTENT
  	                     ,REPLY_WRITER
  	                     ,REF_BNO)
  	   VALUES(SEQ_RNO.NEXTVAL,#{replyContent},#{replyWriter},#{refBno})                  
  	                     
  	
  	</insert>
  	
  	<select id="topList" parameterType="_int" resultType="Board">
  	   SELECT BOARD_NO
  	          ,BOARD_TITLE
  	          ,BOARD_WRITER
  	          ,COUNT
  	          ,TO_CHAR(CREATE_DATE,'YYYY-MM-DD') "CREATE_DATE"
  	          ,CREATE_DATE
  	          ,ORIGIN_NAME
  	   FROM BOARD
  	   ORDER BY COUNT DESC   
  	   <!-- 이때 모델 패키지에있는 board의 createDate 멤버 변수를 String형으로 바꾸자. -->
  	</select>
  	
  	<!-- 
  	<insert id="insertReply" parameterType="Reply">
  	  INSERT INTO REPLY(REPLY_NO
  	                    ,REPLY_CONTENT
  	                    ,REF_BNO
  	                    ,REPLY_WRITER)
  	         VALUES(SEQ_RNO.NEXTVAL,#{replyContent},#{refBno},#{replyWriter})
  	                      
  	                    
  	
  	</insert>
  	 -->
  
  
</mapper>
