<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/mvc"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:websocket="http://www.springframework.org/schema/websocket"
	xsi:schemaLocation="http://www.springframework.org/schema/websocket http://www.springframework.org/schema/websocket/spring-websocket-4.3.xsd
		http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd
		http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">

	<!-- DispatcherServlet Context: defines this servlet's request-processing infrastructure -->
	
	<!-- Enables the Spring MVC @Controller programming model -->
	<annotation-driven />

	<!-- Handles HTTP GET requests for /resources/** by efficiently serving up static resources in the ${webappRoot}/resources directory -->
	<resources mapping="/resources/**" location="/resources/" />

	<!-- Resolves views selected for rendering by @Controllers to .jsp resources in the /WEB-INF/views directory -->
	<!-- viewResolver가 물리적인 경로를 반환할때 앞에 /WEB-INF/views/ 를  논리적인 경로 앞에 붙이고 뒤에는 .jsp를 붙여줌 -->
	<beans:bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<beans:property name="prefix" value="/WEB-INF/views/" />
		<beans:property name="suffix" value=".jsp" />
	</beans:bean>
	
	<!-- 인터셉터 등록 : 어떠한 요청에 어떠한 인터셉터를 동작시킬것인지 등록하기 -->
	<interceptors>
	       <interceptor>
	          <!-- ctrl+shift+c는 주석  -->
              <!-- /* : 첫번째 레벨 전체 요청(컨텍스트 루트 다음), /** : 추가 레벨까지 전체 요청-->
              <!-- <mapping path="/*"/> mapping path : 어떠한 요청에 동작시킬것인지 정하는 태그 -->
<!-- 	             <mapping path="/mypage.me"/> -->
	             	 <mapping path="/*.me"/>  <!-- .me로 끝나는 모든 요청에 대해서 처리   --> 
	             	<mapping path="/*.bo"/>
	             <exclude-mapping path="/list.bo"/>
	             <exclude-mapping path="/topList.bo"/>
	            <!-- 어떠한 인터셉터를 사용할것인지를 풀경로 작성 -->
	             <beans:bean class="com.kh.spring.common.interceptor.TestInterceptor"></beans:bean>
	       </interceptor>
	     
	     <!-- 
	         LoginInterceptor 클래스를 만들어서 로그인 정보가 있으면 흐름 유지 
	         로그인 정보가 없으면 기존 흐름을 막고 메인페이지로 보내버리기
	         이때 세션에 메시지로 로그인 후 이용가능한 서비스입니다. 를 담기 
	         
	         로그인이 필요한 기능들을 생각하여 매핑 연결하기 
	     
	      -->
<!-- 	      <interceptor> -->
<!-- 	          <mapping path="/*.me"/>  -->
<!-- 	          <mapping path="/*.bo"/> -->
	          
	          
<!-- 	          <exclude-mapping path="/enrollForm.me"/> -->
<!-- 	          <exclude-mapping path="/insert.me"/> -->
<!-- 	          <exclude-mapping path="/logout.me"/>  -->
	          
	          
<!-- 	          <exclude-mapping path="/list.bo"/> -->
<!-- 	          <exclude-mapping path="/detail.bo"/> -->
<!-- 	          <exclude-mapping path="/topList.bo"/> -->
<!-- 	          <exclude-mapping path="/search.bo"/> -->
	          
	          
	          
<!-- 	          <beans:bean class="com.kh.spring.common.interceptor.LoginInterceptor"></beans:bean> -->
	      
<!-- 	      </interceptor> -->
	
	</interceptors>
	
	<!-- 웹 소켓 서버 등록 -->
    <beans:bean class="com.kh.spring.websocket.server.BasicServer" id="basic"></beans:bean>
    <beans:bean class="com.kh.spring.websocket.server.GroupServer" id="group"></beans:bean>
    <beans:bean class="com.kh.spring.websocket.server.MemberServer" id="member"></beans:bean>
	<!-- 웹 소켓 서버 클래스 풀경로 id값은 해당 웹소켓 서버의 임의의 아이디값 -->
	
	<!-- 웹 소켓 접속 대상지정 - 요청에 따라 어떤 서버가 응답할 것인지 설정하기, 하단에 Namespaces에 등록하기  -->
    <websocket:handlers> <!-- 웹 소켓 관련된거 처리 -> handler -->
         <!-- 기존 요청 방식 : http://localhost:8080/spring~~~~~ 
             웹 소켓 요청 방식 : ws://localhost:8080/spring~~~~
             
         -->
         
         <!-- handler : 어떠한 서버가 path요청시 처리할것인지 등록 -->
         <!-- 서버에 등록한 id를 handler로 ws://localhost:8080/basic~~  -->
         <websocket:mapping handler="basic" path="/basic"/>
         <websocket:mapping handler="group" path="/group"/>
         <websocket:mapping handler="member" path="/member"/>
         
         <!-- HTTP 통신으로 요청되어진 HttpSession 정보를 접근위한 설정 -->
         <websocket:handshake-interceptors>
            <beans:bean class="org.springframework.web.socket.server.support.HttpSessionHandshakeInterceptor"/> 
         </websocket:handshake-interceptors>
         
         
         
    
    </websocket:handlers>
	
	
	<!-- 파일 업로드 처리용 MultiResolver 등록하기 -->
	<beans:bean class="org.springframework.web.multipart.commons.CommonsMultipartResolver" id="multipartResolver">
	   <!-- 업로드 되는 파일의 인코딩 설정 -->
	   <beans:property name="defaultEncoding" value="UTF-8"></beans:property>
	   <!-- 용량 제한 : 100MB 정도로 설정 100*1024*1024 계산식이 적용되지 않기 때문에 직접 계산한 값을 넣어주기 -->
	   <beans:property name="maxInMemorySize" value="100000000"></beans:property> <!-- 임시 메모리 보관 크기 -->
	   <beans:property name="maxUploadSize" value="100000000"></beans:property> <!-- 업로드 파일 용량 크기 -->
	</beans:bean>
	
	
	
	<!-- component-scan이 되는 범위 -->
	<context:component-scan base-package="com.kh.spring" />
	
	
	
</beans:beans>
